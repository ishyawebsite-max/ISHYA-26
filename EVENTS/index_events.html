<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events | Flames in the Fold</title>
    <style>
        :root {
            --bg-color: #050505;
            --paper-color: #f8f8f8;
            --text-color: #1a1a1a;
            --flame-green: #00ff41;
            --crease-color: #e0e0e0;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden; /* Prevent body scroll, use paper scroll */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            perspective: 2000px;
        }

        /* --- THE SCENE --- */
        #origami-container {
            position: relative;
            width: 90vw;
            max-width: 900px;
            height: 85vh;
            transform-style: preserve-3d;
            transition: all 1.5s cubic-bezier(0.645, 0.045, 0.355, 1);
        }

        /* --- THE FOLDING FLAPS --- */
        .fold-segment {
            position: absolute;
            background-color: var(--paper-color);
            width: 50%;
            height: 50%;
            backface-visibility: hidden;
            transition: all 1.2s ease-in-out;
            z-index: 10;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
            border: 0.5px solid var(--crease-color);
            pointer-events: none; /* Let clicks pass through to content when open */
        }

        .seg-tl { top: 0; left: 0; transform-origin: 100% 100%; transform: rotate3d(1, 1, 0, -170deg); }
        .seg-tr { top: 0; right: 0; transform-origin: 0% 100%; transform: rotate3d(-1, 1, 0, -170deg); }
        .seg-bl { bottom: 0; left: 0; transform-origin: 100% 0%; transform: rotate3d(1, -1, 0, -170deg); }
        .seg-br { bottom: 0; right: 0; transform-origin: 0% 0%; transform: rotate3d(-1, -1, 0, -170deg); }

        .core-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: var(--flame-green);
            filter: blur(25px);
            animation: pulse-flame 1.5s infinite alternate;
            z-index: 1;
        }

        @keyframes pulse-flame {
            from { opacity: 0.4; transform: translate(-50%, -50%) scale(1); }
            to { opacity: 0.9; transform: translate(-50%, -50%) scale(1.6); }
        }

        /* --- THE UNFOLDED CONTENT --- */
        #paper-content {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: var(--paper-color);
            background-image: 
                linear-gradient(to right, transparent 49.5%, var(--crease-color) 50%, transparent 50.5%),
                linear-gradient(to bottom, transparent 49.5%, var(--crease-color) 50%, transparent 50.5%);
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
            padding: 40px;
            box-sizing: border-box;
            overflow-y: auto; /* Allow scrolling for many events */
            opacity: 0;
            transform: scale(0.9);
            transition: all 1s ease 0.4s;
        }

        /* --- STATE: OPEN --- */
        body.is-open .fold-segment { 
            transform: rotate3d(0, 0, 0, 0deg); 
            opacity: 0; /* Hide segments to show content clearly */
        }
        body.is-open .core-glow { opacity: 0; }
        body.is-open #paper-content { opacity: 1; transform: scale(1); }
        
        /* --- CONTENT STYLING --- */
        h1 {
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 6px;
            border-bottom: 2px solid var(--text-color);
            margin-bottom: 30px;
            padding-bottom: 10px;
            color: var(--text-color);
        }

        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            padding-bottom: 50px; /* Space at bottom */
        }

        .event-card {
            border: 1px solid #ccc;
            padding: 20px;
            background: white;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 8px 8px 0px var(--flame-green);
            border-color: black;
        }

        .event-card h3 { margin: 0 0 10px 0; color: #000; text-transform: uppercase; }
        .event-card p { font-size: 0.9rem; line-height: 1.4; color: #444; }

        .btn-register {
            display: block;
            margin-top: 15px;
            padding: 10px;
            background: black;
            color: var(--flame-green);
            text-decoration: none;
            text-align: center;
            font-weight: bold;
            font-size: 0.8rem;
            transition: 0.2s;
        }

        .btn-register:hover {
            background: var(--flame-green);
            color: black;
        }
        
        #loader-text {
            position: absolute;
            bottom: 5%; width: 100%;
            text-align: center;
            color: var(--flame-green);
            animation: blink 1s infinite;
            z-index: 100;
        }
        @keyframes blink { 50% { opacity: 0.3; } }

    </style>
</head>
<body>

    <div id="loader-text">READING THE FOLDS...</div>

    <div id="origami-container">
        <div class="core-glow"></div>
        <div class="fold-segment seg-tl"></div>
        <div class="fold-segment seg-tr"></div>
        <div class="fold-segment seg-bl"></div>
        <div class="fold-segment seg-br"></div>

        <div id="paper-content">
            <h1>Events</h1>
            <div class="events-grid" id="grid">
                <!-- Data Injected Here -->
            </div>
        </div>
    </div>

    <script>
        // 1. YOUR DEPLOYED URL
        const APPSCRIPT_URL = 'https://script.google.com/macros/s/AKfycbziFepV2K3K74He8Nc5YD-k1at9nqMg4EvQwgkAkChJ4CIZDpJQYtkgDNyxOmpwEyr6Qw/exec';
        
        async function fetchEvents() {
            const loader = document.getElementById('loader-text');
            try {
                const response = await fetch(APPSCRIPT_URL, {
                    method: "GET",
                    redirect: "follow"
                });
                
                const data = await response.json();
        
                if (data.result === "error") throw new Error(data.error);
                
                if (data.length === 0) {
                    document.getElementById('grid').innerHTML = "<p>No upcoming events found.</p>";
                } else {
                    renderEvents(data);
                }
                
                // Success - Open Origami
                loader.style.display = 'none';
                document.body.classList.add('is-open');
        
            } catch (error) {
                console.error('Error:', error);
                loader.innerText = "Error: " + error.message;
                loader.style.animation = "none";
                loader.style.color = "red";
            }
        }

        function renderEvents(events) {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            events.forEach(evt => {
                // Note: Headers are converted to lowercase/nospaces by code.gs
                // "Event Name" -> evt.eventname
                // "Register Link" -> evt.registerlink
                
                const card = document.createElement('div');
                card.className = 'event-card';
                
                const name = evt.eventname || "Untitled Event";
                const date = evt.date || "TBA";
                const venue = evt.venue || "TBA";
                const desc = evt.description || "";
                const link = evt.registerlink || "";

                card.innerHTML = `
                    <div>
                        <h3>${name}</h3>
                        <p><strong>${date}</strong><br>${venue}</p>
                        <p>${desc}</p>
                    </div>
                    ${link ? `<a href="${link}" target="_blank" class="btn-register">Register</a>` : ''}
                `;
                grid.appendChild(card);
            });
        }

        window.onload = fetchEvents;
    </script>
</body>
</html>
