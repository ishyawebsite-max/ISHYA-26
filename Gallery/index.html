<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery 2026</title>
    
    <!-- GSAP & ScrollTrigger -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Space+Grotesk:wght@300;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #060606;
            --bg-panel: #181C10;
            --gold: #D6C26A;
            --olive: #3D4324;
            --green: #4D8F48;
            --bright-green: #6ee769; 
            --green-glow: rgba(77, 143, 72, 0.6);
        }

        body {
            background-color: var(--bg-dark);
            color: #eee;
            font-family: 'Space Grotesk', sans-serif;
            margin: 0;
            overflow-x: hidden;
        }

        /* --- BACKGROUND FX --- */
        #ashCanvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.8; }
        .noise-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* --- HEADER --- */
        .hero-section {
            min-height: 40vh;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            position: relative;
            z-index: 10;
        }

        .main-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(4rem, 12vw, 10rem);
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 10px;
            margin: 0;
            text-shadow: 0 0 40px var(--green-glow);
        }
        
        .fold-line {
            position: absolute; width: 1px; height: 100%;
            background: linear-gradient(180deg, transparent, var(--olive), var(--green), transparent);
            left: 50%; top: 0; opacity: 0.3; z-index: -1;
        }

        /* --- AFTERMOVIES SECTION --- */
        .archives-section {
            padding: 50px 5%;
            position: relative; z-index: 20; margin-bottom: 80px;
        }

        .section-label {
            font-family: 'Cinzel', serif; 
            color: var(--bright-green); 
            font-size: 1.2rem;
            letter-spacing: 3px;
            border-bottom: 1px solid var(--green); 
            margin-bottom: 40px;
            padding-bottom: 10px; 
            display: flex; justify-content: space-between;
            text-shadow: 0 0 15px rgba(110, 231, 105, 0.4); 
        }

        .film-strip {
            display: flex; gap: 20px; overflow-x: auto; padding: 20px 0;
            scrollbar-width: none;
        }
        .film-strip::-webkit-scrollbar { display: none; }
        
        .year-tag {
            min-width: 220px; height: 100px;
            background: var(--bg-panel); 
            border: 1px solid var(--olive);
            border-left: 4px solid var(--olive);
            position: relative; cursor: pointer; transition: 0.3s;
            clip-path: polygon(0 0, 90% 0, 100% 30%, 100% 100%, 0 100%);
            display: flex; flex-direction: row; justify-content: space-between; align-items: center;
            padding: 0 25px;
        }

        .year-tag:hover {
            transform: translateX(10px); 
            border-color: var(--gold);
            border-left-color: var(--green); 
            background: #1f2615;
            box-shadow: 0 0 20px rgba(77, 143, 72, 0.2);
        }

        .year-tag h3 { color: #fff; font-size: 2rem; margin: 0; font-family: 'Cinzel', serif; line-height: 1; }
        .year-tag .play-hint { 
            color: var(--green); font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; 
            writing-mode: vertical-rl; transform: rotate(180deg);
        }

        /* --- GALLERY SECTION --- */
        .gallery-header {
            text-align: center; margin-bottom: 80px; position: relative;
        }
        .gallery-subtitle {
            font-family: 'Cinzel', serif; 
            font-size: clamp(2rem, 5vw, 4rem); 
            color: var(--green); 
            letter-spacing: 5px;
            text-shadow: 0 0 20px rgba(77, 143, 72, 0.4);
            display: inline-block;
            border-bottom: 1px solid var(--gold);
            padding-bottom: 10px;
        }

        .gallery-root {
            position: relative; padding-bottom: 150px;
            max-width: 1200px; margin: 0 auto;
        }

        .event-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 150px; position: relative; padding: 0 20px;
        }
        .event-row:nth-child(even) { flex-direction: row-reverse; }

        .text-block { width: 30%; position: relative; z-index: 2; }
        .text-block h2 {
            font-family: 'Cinzel', serif; font-size: 3rem; color: #fff; margin: 0;
            text-shadow: 0 2px 10px #000; line-height: 1.1;
        }

        /* --- ORIGAMI CARD --- */
        .origami-card {
            position: relative;
            cursor: pointer;
            perspective: 1000px;
            width: 60%; 
            aspect-ratio: 16/9;
            transition: width 0.3s;
        }

        .origami-card.is-portrait {
            width: 40%; 
            aspect-ratio: 3/4; 
        }

        .card-frame {
            position: absolute; inset: 0;
            border: 1px solid var(--olive);
            background-color: #000; 
            clip-path: polygon(5% 0, 95% 0, 100% 5%, 100% 95%, 95% 100%, 5% 100%, 0 95%, 0 5%);
            transition: transform 0.3s;
            overflow: hidden;
        }

        .origami-card:hover .card-frame {
            border-color: var(--gold);
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(214, 194, 106, 0.15);
        }

        /* FIX: BACKGROUND COLOR ADDED HERE */
        .img-layer {
            position: absolute; inset: 0; 
            width: 100%; height: 100%;
            object-fit: contain; 
            background-color: #000; /* This hides the image sitting behind it */
            display: block;
        }
        .img-current { z-index: 2; }
        .img-next { z-index: 1; }

        .paper-decoration {
            position: absolute; inset: -10px;
            border: 1px solid var(--green);
            opacity: 0.3; z-index: -1;
            clip-path: polygon(0 0, 100% 0, 100% 80%, 80% 100%, 0 100%);
            transition: 0.5s;
        }
        .origami-card:hover .paper-decoration { transform: translate(15px, 15px); opacity: 0.6; }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; inset: 0; z-index: 1000;
            background: rgba(6, 6, 6, 0.95);
            backdrop-filter: blur(8px);
            display: none; align-items: center; justify-content: center;
        }

        .video-box {
            width: 80%; max-width: 900px; aspect-ratio: 16/9;
            border: 1px solid var(--green);
            box-shadow: 0 0 50px rgba(77, 143, 72, 0.3); background: #000;
        }
        .video-box iframe { width: 100%; height: 100%; border: none; }

        .img-modal-content {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none; 
        }

        .full-img {
            max-width: 90vw; 
            max-height: 90vh; 
            object-fit: contain;
            border: 2px solid var(--gold);
            pointer-events: auto;
            background: #000;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        .close-btn {
            position: absolute; top: 30px; right: 30px;
            color: var(--gold); font-size: 3rem; cursor: pointer;
            font-family: 'Cinzel', serif; z-index: 1001; line-height: 0.5;
        }

        @media (max-width: 768px) {
            .event-row, .event-row:nth-child(even) { flex-direction: column; align-items: flex-start; margin-bottom: 100px; }
            .text-block { width: 100%; margin-bottom: 20px; }
            .origami-card { width: 100%; aspect-ratio: 16/9; }
            .origami-card.is-portrait { width: 100%; aspect-ratio: 3/4; }
            .main-title { font-size: 4rem; }
        }
    </style>
</head>
<body>

<canvas id="ashCanvas"></canvas>
<div class="noise-overlay"></div>
<div class="fold-line"></div>

<header class="hero-section">
    <h1 class="main-title">GALLERY</h1>
</header>

<section class="archives-section">
    <div class="section-label">
        <span>AFTERMOVIES</span>
        <span>WATCH RECAPS</span>
    </div>
    <div class="film-strip" id="movieList"></div>
</section>

<div class="gallery-header">
    <div class="gallery-subtitle">CHITHRALAYA</div>
</div>

<section class="gallery-root" id="galleryRoot"></section>

<div class="modal-overlay" id="vidModal" onclick="closeVideo()">
    <div class="close-btn">&times;</div>
    <div class="video-box" id="vidContainer"></div>
</div>

<div class="modal-overlay" id="imgModal" onclick="closeImage()">
    <div class="close-btn">&times;</div>
    <div class="img-modal-content">
        <img class="full-img" id="fullImg" src="">
    </div>
</div>

<script>
    gsap.registerPlugin(ScrollTrigger);

    const movies = [
        { year: '2025', id: 'https://youtu.be/-HM2rLvpEXE?si=KdUu-uESfWurISWu' }, 
        { year: '2024', id: 'qC0vDKVPCrw' }, 
        { year: '2023', id: 'Scxs7L0vhZ4' }, 
        { year: '2022', id: 'EngW7tLk6R8' }  
    ];

    const API_URL = 'https://script.google.com/macros/s/AKfycbzuOEfCRHEBMA216pJ3oJYaVED2ohOCxAw_XNCbFlf8CK9r-j3K--BXGxcVDOeQHxKJug/exec'; 

    function init() {
        renderMovies();
        fetchGallery();
        initParticles();
        gsap.from(".main-title", { scale: 0.8, opacity: 0, duration: 1.5, ease: "power4.out" });
        gsap.from(".gallery-subtitle", { 
            scrollTrigger: ".gallery-header", y: 50, opacity: 0, duration: 1 
        });
    }

    function renderMovies() {
        const container = document.getElementById('movieList');
        movies.forEach(m => {
            const div = document.createElement('div');
            div.className = 'year-tag';
            div.onclick = () => openVideo(m.id);
            div.innerHTML = `<h3>${m.year}</h3><span class="play-hint">PLAY</span>`;
            container.appendChild(div);
        });
    }

    async function fetchGallery() {
        try {
            const req = await fetch(API_URL);
            const data = await req.json();
            const root = document.getElementById('galleryRoot');
            
            data.forEach((item, i) => {
                const row = document.createElement('div');
                row.className = 'event-row';
                
                const imagesJSON = JSON.stringify(item.images);
                const firstImg = item.images[0];
                const secondImg = item.images.length > 1 ? item.images[1] : firstImg;

                row.innerHTML = `
                    <div class="text-block">
                        <h2>${item.eventName}</h2>
                    </div>
                    
                    <div class="origami-card" onclick="openImage(this)">
                        <div class="paper-decoration"></div>
                        <div class="card-frame">
                            <img src="${firstImg}" class="img-layer img-current">
                            <img src="${secondImg}" class="img-layer img-next">
                        </div>
                    </div>
                `;
                
                const card = row.querySelector('.origami-card');
                card.dataset.images = imagesJSON;
                card.dataset.idx = 0;

                const tempImg = new Image();
                tempImg.src = firstImg;
                tempImg.onload = () => {
                    if(tempImg.height > tempImg.width) {
                        card.classList.add('is-portrait');
                    }
                    gsap.from(row, {
                        y: 100, opacity: 0, duration: 1,
                        scrollTrigger: { trigger: row, start: "top 85%" }
                    });
                };
                root.appendChild(row);
                if(item.images.length > 1) {
                    setTimeout(() => startCycle(card, item.images), i * 500);
                }
            });
        } catch(e) { console.error(e); }
    }

    function startCycle(card, images) {
        setInterval(() => {
            let idx = parseInt(card.dataset.idx);
            let nextIdx = (idx + 1) % images.length;
            const currImg = card.querySelector('.img-current');
            const nextImg = card.querySelector('.img-next');

            nextImg.src = images[nextIdx];
            gsap.to(currImg, {
                clipPath: "polygon(150% 0, 150% 0, 150% 100%, 150% 100%)", 
                duration: 1.2, ease: "power3.inOut",
                onComplete: () => {
                    currImg.src = images[nextIdx]; 
                    gsap.set(currImg, { clipPath: "polygon(0 0, 100% 0, 100% 100%, 0 100%)" });
                    card.dataset.idx = nextIdx;
                    let futureIdx = (nextIdx + 1) % images.length;
                    nextImg.src = images[futureIdx];
                }
            });
        }, 3000); 
    }

    function openImage(cardElem) {
        const currSrc = cardElem.querySelector('.img-current').src;
        const hqSrc = currSrc.replace('=s800', '=s2000'); 
        const modal = document.getElementById('imgModal');
        const img = document.getElementById('fullImg');
        img.src = hqSrc;
        modal.style.display = 'flex';
        const tl = gsap.timeline();
        tl.set(img, { clipPath: "polygon(50% 50%, 50% 50%, 50% 50%, 50% 50%)", scale: 0.8 });
        tl.to(img, { clipPath: "polygon(48% 0, 52% 0, 52% 100%, 48% 100%)", scale: 0.9, duration: 0.4, ease: "power2.out" });
        tl.to(img, { clipPath: "polygon(0 0, 100% 0, 100% 100%, 0 100%)", scale: 1, duration: 0.7, ease: "expo.out" });
    }

    function closeImage() {
        const img = document.getElementById('fullImg');
        gsap.to(img, {
            clipPath: "polygon(50% 50%, 50% 50%, 50% 50%, 50% 50%)",
            duration: 0.4,
            onComplete: () => { document.getElementById('imgModal').style.display = 'none'; }
        });
    }

    function openVideo(id) {
        const m = document.getElementById('vidModal');
        const c = document.getElementById('vidContainer');
        c.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1" allow="autoplay" allowfullscreen></iframe>`;
        m.style.display = 'flex';
        gsap.from(c, { scale: 0, duration: 0.5, ease: "back.out(1.7)" });
    }
    
    function closeVideo() {
        document.getElementById('vidModal').style.display = 'none';
        document.getElementById('vidContainer').innerHTML = '';
    }

    function initParticles() {
        const canvas = document.getElementById('ashCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];
        function resize() { width = canvas.width = window.innerWidth; height = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        class P {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * width; this.y = height + 50;
                this.size = Math.random() * 5 + 2;
                this.speed = Math.random() * 1.5 + 0.5;
                this.color = Math.random() > 0.5 ? '#4D8F48' : '#D6C26A';
                this.rot = Math.random() * 360;
            }
            update() { this.y -= this.speed; this.rot += 2; if(this.y < -50) this.reset(); }
            draw() {
                ctx.save(); ctx.translate(this.x, this.y); ctx.rotate(this.rot * Math.PI/180);
                ctx.fillStyle = this.color; ctx.globalAlpha = 0.6;
                ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                ctx.restore();
            }
        }
        for(let i=0; i<50; i++) particles.push(new P());
        function anim() { ctx.clearRect(0,0,width,height); particles.forEach(p=>{ p.update(); p.draw(); }); requestAnimationFrame(anim); }
        anim();
    }
    init();
</script>
</body>
</html>
