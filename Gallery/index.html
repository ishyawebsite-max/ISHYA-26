<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="shortcut icon" type="image/x-icon" href="../Logo Ishya.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#060606">
    <meta name="description" content="Gallery 2026 - A cinematic archive">
    <title>Gallery 2026</title>
    
    <!-- 1. Preconnect for faster Font Loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Space+Grotesk:wght@300;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/global.css"> <!--Header addition #1-->
    
    <!-- GSAP (Defer loading to not block render) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js" defer></script>
    <script src="/layout.js" defer></script> <!--Header addition #2-->
    <style>
        :root {
            --bg-dark: #060606;
            --bg-panel: #181C10;
            --gold: #D6C26A;
            --olive: #3D4324;
            --green: #4D8F48;
            --bright-green: #6ee769; 
            --green-glow: rgba(77, 143, 72, 0.6);
        }

        body {
            background-color: var(--bg-dark);
            color: #eee;
            font-family: 'Space Grotesk', sans-serif;
            margin: 0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- BACKGROUND FX --- */
        #ashCanvas { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.8; pointer-events: none; }
        
        .noise-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
        }

        /* --- HEADER --- */
        .hero-section {
            min-height: 40vh;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            position: relative;
            z-index: 10;
        }

        .main-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(3.5rem, 12vw, 10rem);
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 5px;
            margin: 0;
            text-shadow: 0 0 40px var(--green-glow);
            text-align: center;
            will-change: transform, opacity;
        }
        
        .fold-line {
            position: absolute; width: 1px; height: 100%;
            background: linear-gradient(180deg, transparent, var(--olive), var(--green), transparent);
            left: 50%; top: 0; opacity: 0.3; z-index: -1;
        }

        /* --- ARCHIVES (YEARS) SECTION --- */
        .archives-section {
            padding: 50px 5%;
            position: relative; z-index: 20; margin-bottom: 80px;
        }

        .section-label {
            font-family: 'Cinzel', serif; 
            color: var(--bright-green); 
            font-size: 1.2rem;
            letter-spacing: 3px;
            border-bottom: 1px solid var(--green); 
            margin-bottom: 30px;
            padding-bottom: 10px; 
            display: flex; justify-content: space-between;
            text-shadow: 0 0 15px rgba(110, 231, 105, 0.4); 
        }

        /* GRID for Mobile, STRIP for Desktop */
        .film-strip {
            display: grid;
            gap: 15px;
            /* Mobile Default: 2 Columns */
            grid-template-columns: repeat(2, 1fr); 
        }

        /* Desktop: Horizontal Scroll */
        @media (min-width: 768px) {
            .film-strip {
                display: flex;
                overflow-x: auto;
                padding: 20px 0;
                grid-template-columns: none;
            }
        }

        .film-strip::-webkit-scrollbar { display: none; }
        
        .year-tag {
            min-width: 0;
            width: 100%;
            height: 80px;
            background: var(--bg-panel); 
            border: 1px solid var(--olive);
            border-left: 4px solid var(--olive);
            position: relative; cursor: pointer; transition: transform 0.2s, background 0.2s;
            clip-path: polygon(0 0, 90% 0, 100% 30%, 100% 100%, 0 100%);
            display: flex; flex-direction: row; justify-content: space-between; align-items: center;
            padding: 0 15px;
            box-sizing: border-box;
        }

        @media (min-width: 768px) {
            .year-tag {
                min-width: 220px;
                height: 100px;
                padding: 0 25px;
                transition: 0.3s;
            }
            .year-tag:hover {
                transform: translateX(10px); 
                border-color: var(--gold);
                border-left-color: var(--green); 
                background: #1f2615;
                box-shadow: 0 0 20px rgba(77, 143, 72, 0.2);
            }
        }

        .year-tag:active {
            background: #1f2615;
            border-color: var(--gold);
        }

        .year-tag h3 { color: #fff; font-size: 1.5rem; margin: 0; font-family: 'Cinzel', serif; line-height: 1; }
        .year-tag .play-hint { 
            color: var(--green); font-size: 0.6rem; letter-spacing: 2px; text-transform: uppercase; 
            writing-mode: vertical-rl; transform: rotate(180deg);
        }
        @media (min-width: 768px) { .year-tag h3 { font-size: 2rem; } .year-tag .play-hint { font-size: 0.7rem; } }

        /* --- GALLERY SECTION --- */
        .gallery-header {
            text-align: center; margin-bottom: 60px; position: relative;
        }
        .gallery-subtitle {
            font-family: 'Cinzel', serif; 
            font-size: clamp(2rem, 5vw, 4rem); 
            color: var(--green); 
            letter-spacing: 5px;
            text-shadow: 0 0 20px rgba(77, 143, 72, 0.4);
            display: inline-block;
            border-bottom: 1px solid var(--gold);
            padding-bottom: 10px;
        }

        .gallery-root {
            position: relative; padding-bottom: 100px;
            max-width: 1200px; margin: 0 auto;
        }

        /* --- FIXED LAYOUT FOR EVENTS --- */
        .event-row {
            display: flex;
            
            /* MOBILE DEFAULT: Stack Vertically */
            flex-direction: column; 
            justify-content: center; 
            align-items: center;
            text-align: center;
            
            margin-bottom: 100px; 
            position: relative; 
            padding: 0 20px;
            opacity: 0;
        }
        
        .text-block { 
            /* Mobile: Full width, margin bottom to separate from image */
            width: 100%; 
            position: relative; 
            z-index: 2; 
            margin-bottom: 30px; 
        }

        /* DESKTOP LAYOUT (Tablet and up) */
        @media (min-width: 768px) {
            .event-row { 
                /* Restore Side-by-side */
                flex-direction: row; 
                justify-content: space-between; 
                text-align: left;
                margin-bottom: 150px; 
            }
            /* Zig-zag pattern */
            .event-row:nth-child(even) { flex-direction: row-reverse; }
            
            .text-block { 
                width: 35%; 
                margin-bottom: 0; 
            }
        }

        .text-block h2 {
            font-family: 'Cinzel', serif; font-size: 2rem; color: #fff; margin: 0;
            text-shadow: 0 2px 10px #000; line-height: 1.1;
        }
        @media (min-width: 768px) { .text-block h2 { font-size: 3rem; } }

        /* --- ORIGAMI CARD --- */
        .origami-card {
            position: relative;
            cursor: pointer;
            perspective: 1000px;
            /* Mobile: Full Width */
            width: 100%; 
            aspect-ratio: 16/9;
            transition: width 0.3s;
            -webkit-tap-highlight-color: transparent;
        }
        @media (min-width: 768px) { .origami-card { width: 60%; } }

        .origami-card.is-portrait {
            /* Portrait Logic */
            width: 80%; 
            aspect-ratio: 3/4; 
            margin: 0 auto;
        }
        @media (min-width: 768px) { .origami-card.is-portrait { width: 40%; margin: 0; } }

        .card-frame {
            position: absolute; inset: 0;
            border: 1px solid var(--olive);
            background-color: #0d0d0d; 
            clip-path: polygon(5% 0, 95% 0, 100% 5%, 100% 95%, 95% 100%, 5% 100%, 0 95%, 0 5%);
            transition: transform 0.3s;
            overflow: hidden;
        }

        @media (hover: hover) {
            .origami-card:hover .card-frame {
                border-color: var(--gold);
                transform: scale(1.02);
                box-shadow: 0 0 30px rgba(214, 194, 106, 0.15);
            }
        }

        .img-layer {
            position: absolute; inset: 0; 
            width: 100%; height: 100%;
            object-fit: cover; 
            background-color: #000; 
            display: block;
            will-change: clip-path;
        }
        .img-current { z-index: 2; }
        .img-next { z-index: 1; }

        .paper-decoration {
            position: absolute; inset: -10px;
            border: 1px solid var(--green);
            opacity: 0.3; z-index: -1;
            clip-path: polygon(0 0, 100% 0, 100% 80%, 80% 100%, 0 100%);
            transition: 0.5s;
        }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; inset: 0; z-index: 1000;
            background: rgba(6, 6, 6, 0.95);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: none; align-items: center; justify-content: center;
        }

        /* Facade Video Box */
        .video-box {
            width: 90%; max-width: 900px; aspect-ratio: 16/9;
            border: 1px solid var(--green);
            box-shadow: 0 0 50px rgba(77, 143, 72, 0.3); background: #000;
            position: relative;
            overflow: hidden;
        }
        .video-box iframe { width: 100%; height: 100%; border: none; }

        .vid-thumb { width: 100%; height: 100%; object-fit: cover; opacity: 0.7; transition: opacity 0.3s;}
        .vid-play-btn {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 70px; height: 50px;
            background: rgba(30, 30, 30, 0.8);
            border-radius: 10px; border: 1px solid var(--gold);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 2;
        }
        .vid-play-btn::after {
            content: '';
            border-style: solid; border-width: 10px 0 10px 20px;
            border-color: transparent transparent transparent var(--gold);
        }
        .video-box:hover .vid-thumb { opacity: 1; }
        .video-box:hover .vid-play-btn { background: var(--green); border-color: #fff; }
        .video-box:hover .vid-play-btn::after { border-left-color: #fff; }

        .img-modal-content {
            width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            pointer-events: none; 
        }

        .full-img {
            max-width: 95vw; 
            max-height: 90vh; 
            object-fit: contain;
            border: 2px solid var(--gold);
            pointer-events: auto;
            background: #000;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }

        .close-btn {
            position: absolute; top: 20px; right: 20px;
            color: var(--gold); font-size: 3rem; cursor: pointer;
            font-family: 'Cinzel', serif; z-index: 1001; line-height: 0.5;
            padding: 10px; 
        }
    </style>
</head>
<body>
    <!-- ISHYA AERO / STICKY GLASS HEADER -->
    <!-- <style>
        :root {
            --ishya-gold: #f0d57a;
            --ishya-green: #4ade80;
            --ishya-peach: #ffb08e;
            --ishya-creme: #fef9c3;
            --ishya-white: #ffffff;
            --ishya-dark-aero: rgba(5, 8, 15, 0.6); /* Translucent dark base */
            --ishya-glass-bright: rgba(255, 255, 255, 0.12); /* Light whitening */
            --anim-fluid: cubic-bezier(0.16, 1, 0.3, 1);
            --bar-height: 75px; 
        }

        /* 1. CONTENT SPACER */
        .ishya-header-spacer {
            display: block;
            width: 100%;
            height: var(--bar-height);
        }

        /* 2. AERO BACKDROP WITH LIGHT FLUIDS */
        .ishya-nav-backdrop {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: var(--bar-height);
            background: var(--ishya-dark-aero);
            backdrop-filter: blur(35px) saturate(160%);
            -webkit-backdrop-filter: blur(35px) saturate(160%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 9997;
            overflow: hidden;
        }

        /* Subtle Light Fluid Layer */
        .ishya-fluid-layer {
            position: absolute;
            inset: -30%;
            z-index: -1;
            opacity: 0.2; /* Toned down density as requested */
            filter: blur(60px);
            background: 
                radial-gradient(circle at 15% 25%, var(--ishya-green) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, var(--ishya-gold) 0%, transparent 40%),
                radial-gradient(circle at 50% 50%, var(--ishya-peach) 0%, transparent 35%),
                radial-gradient(circle at 30% 85%, var(--ishya-creme) 0%, transparent 30%);
            animation: fluidDrift 30s ease-in-out infinite alternate;
            will-change: transform;
        }

        @keyframes fluidDrift {
            from { transform: translate(0, 0) scale(1); }
            to { transform: translate(4%, 3%) scale(1.15); }
        }

        /* Top Whitening Glow */
        .ishya-nav-backdrop::before {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--ishya-glass-bright), transparent);
            z-index: 2;
        }

        /* 3. NAV CONTAINER PILL */
        .ishya-nav-container {
            position: fixed;
            z-index: 9999;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 56px; /* Increased to fit larger logo */
            height: 56px;
            background: rgba(255, 255, 255, 0.04); /* Highly translucent */
            border: 1px solid var(--ishya-gold);
            border-radius: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            overflow: hidden;
            cursor: pointer;
            will-change: width, height, background;
            transition: 
                width 0.6s var(--anim-fluid),
                height 0.6s var(--anim-fluid),
                background 0.4s ease,
                border-radius 0.4s ease;
        }

        /* LOGO - Increased Size */
        .ishya-logo-btn {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 56px;
            display: flex; justify-content: center; align-items: center;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .ishya-logo-btn img { 
            height: 38px; /* Increased Size */
            width: auto;
            filter: drop-shadow(0 0 10px var(--ishya-green));
        }

        /* MENU GRID */
        .ishya-menu-grid {
            display: flex; width: 100%; height: 100%;
            align-items: center; justify-content: space-evenly;
            opacity: 0; pointer-events: none;
            box-sizing: border-box;
        }

        .ishya-link {
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center;
            text-decoration: none; color: #fff;
            padding: 8px; min-width: 90px;
            transition: transform 0.3s var(--anim-fluid);
        }

        .ishya-link svg {
            width: 24px; height: 24px;
            stroke: var(--ishya-green);
            fill: none; stroke-width: 1.8;
            margin-bottom: 5px;
            transition: stroke 0.3s ease, transform 0.3s ease;
        }

        .ishya-link span {
            font-size: 10px; font-weight: 800;
            letter-spacing: 1px; text-transform: uppercase;
            color: var(--ishya-creme); opacity: 0.8;
        }

        /* 4. EXPANDED STATE (Translucent & Sticky) */
        .ishya-nav-container.expanded {
            width: 880px; 
            height: 68px;
            border-radius: 14px;
            background: rgba(255, 255, 255, 0.03); /* Ultra translucent expanded menu */
            border-color: rgba(255, 255, 255, 0.15);
            top: 4px;
        }

        .ishya-nav-container.expanded .ishya-logo-btn { 
            opacity: 0; 
            transform: scale(0.8);
            pointer-events: none; 
        }
        .ishya-nav-container.expanded .ishya-menu-grid { 
            opacity: 1; 
            pointer-events: auto; 
        }

        .ishya-link:hover { transform: translateY(-3px); }
        .ishya-link:hover svg { stroke: var(--ishya-gold); }
        .ishya-link:hover span { opacity: 1; color: #fff; text-shadow: 0 0 10px var(--ishya-gold); }

        /* 5. MOBILE OPTIMIZATION */
        @media screen and (max-width: 900px) {
            .ishya-nav-container { top: 10px; width: 56px; height: 56px; }

            .ishya-nav-container.expanded {
                width: 94%; height: auto; min-height: 380px;
                top: 10px; border-radius: 24px;
                background: rgba(10, 15, 20, 0.9); /* Darker on mobile for readability */
                padding-bottom: 30px;
            }

            .ishya-nav-container.expanded .ishya-menu-grid {
                display: grid; grid-template-columns: repeat(2, 1fr);
                gap: 15px; padding: 75px 15px 0 15px;
            }

            .ishya-link {
                background: rgba(255,255,255,0.04);
                padding: 25px 10px;
                clip-path: polygon(0 0, 100% 0, 100% 88%, 88% 100%, 0 100%);
                border: 1px solid rgba(255,255,255,0.06);
            }

            /* Keep logo visible as a header inside the mobile menu */
            .ishya-nav-container.expanded .ishya-logo-btn {
                opacity: 1; transform: scale(1); height: 60px;
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }
        }
    </style>

    <div class="ishya-header-spacer"></div>

    <div id="ishya-floating-nav-wrapper">
        <div class="ishya-nav-backdrop">
            <div class="ishya-fluid-layer"></div>
        </div>
        
        <nav class="ishya-nav-container" id="ishyaHeader">
            <div class="ishya-logo-btn">
                <img src="../Logo Ishya.ico" alt="ISHYA">
            </div>

            <div class="ishya-menu-grid">
                <a href="../homemob.html" class="ishya-link">
                    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg>
                    <span>Home</span>
                </a>
                <a href="./EVENTS/index_events.html" class="ishya-link">
                    <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M3 10h18"/></svg>
                    <span>Events</span>
                </a>
                <a href="./STORE/index_store.html" class="ishya-link">
                    <svg viewBox="0 0 24 24"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M9 6a3 3 0 1 0 6 0"/><circle cx="12" cy="13" r="3"/></svg>
                    <span>Store</span>
                </a>
                <a href="./SPONSOR/index_sponsor.html" class="ishya-link">
                    <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    <span>Sponsors</span>
                </a>
                <a href="./TEAM/index_team.html" class="ishya-link">
                    <svg viewBox="0 0 24 24"><path d="M12 2L3 7v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-9-5z"/></svg>
                    <span>Team</span>
                </a>
                <a href="./RESULTS/index_results.html" class="ishya-link">
                    <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
                    <span>Results</span>
                </a>
            </div>
        </nav>
    </div>

    <script>
        (function(){
            const nav = document.getElementById('ishyaHeader');
            let isExpanded = false;

            const toggleNav = (state) => {
                isExpanded = (state !== undefined) ? state : !isExpanded;
                nav.classList.toggle('expanded', isExpanded);
            };

            // Desktop Hover functionality (Optional, but usually expected)
            nav.addEventListener('mouseenter', () => { 
                if(window.innerWidth > 900 && !isExpanded) nav.classList.add('expanded'); 
            });
            nav.addEventListener('mouseleave', () => { 
                if(window.innerWidth > 900 && !isExpanded) nav.classList.remove('expanded'); 
            });

            // Sticky Click functionality
            nav.addEventListener('click', (e) => {
                if (e.target.closest('a')) return; // Allow links to be clicked
                toggleNav(); // This "latches" it open
            });

            // Close when clicking anywhere outside
            document.addEventListener('click', (e) => {
                if (!nav.contains(e.target) && isExpanded) {
                    toggleNav(false);
                }
            });
        })();
    </script> -->
    <ishya-header></ishya-header>
<canvas id="ashCanvas"></canvas>
<div class="noise-overlay"></div>
<div class="fold-line"></div>

<header class="hero-section">
    <h1 class="main-title">GALLERY</h1>
</header>

<section class="archives-section">
    <div class="section-label">
        <span>ARCHIVES</span>
        <span>RECAPS</span>
    </div>
    <!-- Responsive Grid/Strip -->
    <div class="film-strip" id="movieList"></div>
</section>

<div class="gallery-header">
    <div class="gallery-subtitle">CHITHRALAYA</div>
</div>

<section class="gallery-root" id="galleryRoot"></section>

<!-- Video Modal -->
<div class="modal-overlay" id="vidModal" onclick="closeVideo(event)">
    <div class="close-btn">&times;</div>
    <div class="video-box" id="vidContainer">
        <!-- Content injected via JS -->
    </div>
</div>

<!-- Image Modal -->
<div class="modal-overlay" id="imgModal" onclick="closeImage()">
    <div class="close-btn">&times;</div>
    <div class="img-modal-content">
        <img class="full-img" id="fullImg" src="" alt="Full View">
    </div>
</div>

<script>
    const movies = [
        { year: '2025', id: '-HM2rLvpEXE' }, 
        { year: '2024', id: '_b32fejUrsg' }, 
        { year: '2023', id: 'eX7hd4eWCrQ' }, 
        { year: '2022', id: 'v3Ho5LnvZns' },
        { year: '2021', id: 'KlhYSjmSdUY' },
        { year: '2019', id: '4rW3SuT30m8' },
        { year: '2018', id: 'KurHaZKjKVI' },
        { year: '2017', id: 'GqDB4Ygdi3g' }
    ];

    const API_URL = 'https://script.google.com/macros/s/AKfycbzuOEfCRHEBMA216pJ3oJYaVED2ohOCxAw_XNCbFlf8CK9r-j3K--BXGxcVDOeQHxKJug/exec'; 

    const isMobile = window.innerWidth < 768;

    document.addEventListener("DOMContentLoaded", () => {
        const checkGSAP = setInterval(() => {
            if (window.gsap && window.ScrollTrigger) {
                clearInterval(checkGSAP);
                gsap.registerPlugin(ScrollTrigger);
                init();
            }
        }, 100);
    });

    function init() {
        renderMovies();
        fetchGallery();
        initParticles();
        
        gsap.from(".main-title", { scale: 0.9, opacity: 0, duration: 1.2, ease: "power2.out" });
        gsap.from(".gallery-subtitle", { 
            scrollTrigger: { trigger: ".gallery-header", start: "top 80%" }, 
            y: 30, opacity: 0, duration: 1 
        });
    }

    function renderMovies() {
        const container = document.getElementById('movieList');
        const fragment = document.createDocumentFragment(); 
        
        movies.forEach(m => {
            const div = document.createElement('div');
            div.className = 'year-tag';
            div.onclick = () => openVideoFacade(m.id, m.year);
            div.innerHTML = `<h3>${m.year}</h3><span class="play-hint">PLAY</span>`;
            fragment.appendChild(div);
        });
        container.appendChild(fragment);
    }

    async function fetchGallery() {
        try {
            const req = await fetch(API_URL);
            const data = await req.json();
            const root = document.getElementById('galleryRoot');
            const fragment = document.createDocumentFragment();
            
            data.forEach((item, i) => {
                const row = document.createElement('div');
                row.className = 'event-row';
                
                const firstImg = item.images[0];
                const secondImg = item.images.length > 1 ? item.images[1] : firstImg;
                
                row.innerHTML = `
                    <div class="text-block">
                        <h2>${item.eventName}</h2>
                    </div>
                    
                    <div class="origami-card" onclick="openImage(this)">
                        <div class="paper-decoration"></div>
                        <div class="card-frame">
                            <img src="${firstImg}" loading="lazy" class="img-layer img-current" alt="${item.eventName}">
                            <img src="${secondImg}" loading="lazy" class="img-layer img-next" alt="Next slide">
                        </div>
                    </div>
                `;
                
                const card = row.querySelector('.origami-card');
                card.images = item.images; 
                card.dataset.idx = 0;

                const tempImg = new Image();
                tempImg.src = firstImg;
                tempImg.onload = () => {
                    if(tempImg.height > tempImg.width) {
                        card.classList.add('is-portrait');
                    }
                    gsap.to(row, { opacity: 1, duration: 0.5 });
                    gsap.from(row, {
                        y: 50, duration: 0.8,
                        scrollTrigger: { trigger: row, start: "top 90%" }
                    });
                };
                fragment.appendChild(row);
                
                if(item.images.length > 1) {
                    setTimeout(() => startCycle(card), i * 500 + 2000);
                }
            });
            root.appendChild(fragment);

        } catch(e) { console.error("Gallery Load Error:", e); }
    }

    function startCycle(card) {
        setInterval(() => {
            if (!document.hidden) {
                const images = card.images;
                let idx = parseInt(card.dataset.idx);
                let nextIdx = (idx + 1) % images.length;
                const currImg = card.querySelector('.img-current');
                const nextImg = card.querySelector('.img-next');

                nextImg.src = images[nextIdx];
                
                gsap.to(currImg, {
                    clipPath: "polygon(150% 0, 150% 0, 150% 100%, 150% 100%)", 
                    duration: 1.2, ease: "power3.inOut",
                    onComplete: () => {
                        currImg.src = images[nextIdx]; 
                        gsap.set(currImg, { clipPath: "polygon(0 0, 100% 0, 100% 100%, 0 100%)" });
                        card.dataset.idx = nextIdx;
                        let futureIdx = (nextIdx + 1) % images.length;
                        nextImg.src = images[futureIdx];
                    }
                });
            }
        }, 4000); 
    }

    function openVideoFacade(id) {
        const m = document.getElementById('vidModal');
        const c = document.getElementById('vidContainer');
        c.innerHTML = `
            <img class="vid-thumb" src="https://img.youtube.com/vi/${id}/maxresdefault.jpg" alt="Video Thumbnail">
            <div class="vid-play-btn" onclick="playYouTube('${id}')"></div>
        `;
        m.style.display = 'flex';
        gsap.from(c, { scale: 0.8, opacity: 0, duration: 0.3, ease: "back.out(1.2)" });
    }

    function playYouTube(id) {
        const c = document.getElementById('vidContainer');
        c.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1&rel=0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    }
    
    function closeVideo(e) {
        if(e.target.id === 'vidModal' || e.target.classList.contains('close-btn')) {
            document.getElementById('vidModal').style.display = 'none';
            document.getElementById('vidContainer').innerHTML = ''; 
        }
    }

    function openImage(cardElem) {
        const currSrc = cardElem.querySelector('.img-current').src;
        const hqSrc = currSrc.replace('=s800', '=s2000'); 
        
        const modal = document.getElementById('imgModal');
        const img = document.getElementById('fullImg');
        
        img.src = hqSrc;
        modal.style.display = 'flex';
        
        gsap.fromTo(img, 
            { scale: 0.8, opacity: 0 }, 
            { scale: 1, opacity: 1, duration: 0.4, ease: "power2.out" }
        );
    }

    function closeImage() {
        gsap.to('#fullImg', {
            scale: 0.8, opacity: 0, duration: 0.3,
            onComplete: () => { document.getElementById('imgModal').style.display = 'none'; }
        });
    }

    function initParticles() {
        const canvas = document.getElementById('ashCanvas');
        const ctx = canvas.getContext('2d');
        let width, height, particles = [];
        
        const particleCount = isMobile ? 15 : 50; 

        function resize() { 
            width = canvas.width = window.innerWidth; 
            height = canvas.height = window.innerHeight; 
        }
        window.addEventListener('resize', resize); 
        resize();

        class P {
            constructor() { this.reset(); }
            reset() {
                this.x = Math.random() * width; 
                this.y = height + Math.random() * 100; 
                this.size = Math.random() * (isMobile ? 3 : 5) + 2;
                this.speed = Math.random() * 1 + 0.5;
                this.color = Math.random() > 0.5 ? '#4D8F48' : '#D6C26A';
                this.rot = Math.random() * 360;
            }
            update() { 
                this.y -= this.speed; 
                this.rot += 1; 
                if(this.y < -50) this.reset(); 
            }
            draw() {
                ctx.save(); 
                ctx.translate(this.x, this.y); 
                ctx.rotate(this.rot * Math.PI/180);
                ctx.fillStyle = this.color; 
                ctx.globalAlpha = 0.6;
                ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
                ctx.restore();
            }
        }

        for(let i=0; i<particleCount; i++) particles.push(new P());

        function anim() { 
            ctx.clearRect(0,0,width,height); 
            for(let i=0; i<particles.length; i++) {
                particles[i].update(); 
                particles[i].draw();
            }
            requestAnimationFrame(anim); 
        }
        anim();
    }
</script>
<ishya-footer></ishya-footer>
</body>
</html>
