<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inferno Gallery | Origami Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Outfit:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --fire: #ff4d00;
            --ember: #ffcc00;
            --bg: #050505;
            --card-bg: rgba(15, 15, 15, 0.9);
        }

        body {
            background-color: var(--bg);
            color: white;
            font-family: 'Outfit', sans-serif;
            margin: 0;
            overflow-x: hidden;
        }

        #bgCanvas {
            position: fixed;
            top: 0; left: 0;
            z-index: -1;
        }

        /* --- TIMELINE --- */
        .timeline {
            max-width: 1000px;
            margin: 80px auto;
            position: relative;
            padding: 20px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 2px; height: 100%;
            background: linear-gradient(to bottom, transparent, var(--fire), var(--ember), transparent);
            box-shadow: 0 0 15px var(--fire);
        }

        .node {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 80px;
            position: relative;
        }

        .node:nth-child(even) { flex-direction: row-reverse; }

        .node-dot {
            position: absolute;
            left: 50%; transform: translateX(-50%);
            width: 16px; height: 16px;
            background: var(--ember);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--fire);
            z-index: 5;
        }

        /* --- THE CARD (FIXED IMAGE CUTOFF) --- */
        .card {
            width: 44%;
            background: var(--card-bg);
            border: 1px solid rgba(255, 77, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            backdrop-filter: blur(10px);
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card:hover {
            transform: scale(1.03);
            border-color: var(--ember);
            box-shadow: 0 0 30px rgba(255, 77, 0, 0.3);
        }

        .event-title {
            font-family: 'Cinzel', serif;
            color: var(--ember);
            font-size: 1.1rem;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .img-stack {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 10;
            background: #000; /* Black bars if image is a different ratio */
            border-radius: 8px;
            overflow: hidden;
        }

        .img-stack img {
            position: absolute;
            inset: 0;
            width: 100%; height: 100%;
            /* CHANGE: contain ensures the whole image is visible, no cutoffs */
            object-fit: contain; 
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .img-stack img.active { opacity: 1; }

        /* --- REAL ORIGAMI MODAL --- */
        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            perspective: 2000px;
        }

        .origami-container {
            width: 80%;
            max-width: 800px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s ease;
        }

        /* Split Panels for Folding Effect */
        .panel {
            width: 100%;
            height: 50%;
            overflow: hidden;
            position: relative;
            transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            background: #000;
            border: 2px solid var(--fire);
        }

        .panel-top {
            transform-origin: bottom;
            transform: rotateX(-90deg); /* Folded up */
            border-bottom: none;
        }

        .panel-bottom {
            transform-origin: top;
            transform: rotateX(90deg); /* Folded down */
            border-top: none;
        }

        .panel img {
            width: 100%;
            height: 200%; /* Image is twice the height of panel */
            object-fit: contain;
            position: absolute;
        }

        .panel-bottom img { top: -100%; } /* Shows the bottom half */

        /* Opening States */
        .modal.open { display: flex; }
        .modal.open .panel-top { transform: rotateX(0deg); }
        .modal.open .panel-bottom { transform: rotateX(0deg); }

        @media (max-width: 768px) {
            .timeline::before { left: 20px; transform: none; }
            .node { flex-direction: row !important; justify-content: flex-start; padding-left: 50px; }
            .card { width: 90%; }
            .node-dot { left: 20px; }
        }
    </style>
</head>
<body>

<canvas id="bgCanvas"></canvas>

<div class="timeline" id="gallery"></div>

<!-- Origami Modal -->
<div class="modal" id="modal" onclick="closeModal()">
    <div class="origami-container" id="origami">
        <div class="panel panel-top"><img id="imgTop" src=""></div>
        <div class="panel panel-bottom"><img id="imgBottom" src=""></div>
    </div>
</div>

<script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbzuOEfCRHEBMA216pJ3oJYaVED2ohOCxAw_XNCbFlf8CK9r-j3K--BXGxcVDOeQHxKJug/exec';

    async function init() {
        try {
            const res = await fetch(API_URL);
            const data = await res.json();
            render(data);
        } catch (e) { console.error(e); }
    }

    function render(data) {
        const container = document.getElementById('gallery');
        data.forEach((item, idx) => {
            const div = document.createElement('div');
            div.className = 'node';
            div.innerHTML = `
                <div class="node-dot"></div>
                <div class="card" onmouseenter="startCycle(this)" onmouseleave="stopCycle(this)" onclick="openOrigami('${item.images[0]}')">
                    <div class="event-title">${item.eventName}</div>
                    <div class="img-stack">
                        ${item.images.map((img, i) => `<img src="${img}" class="${i===0?'active':''}">`).join('')}
                    </div>
                </div>
                <div style="width:44%"></div>
            `;
            container.appendChild(div);
        });
    }

    // Hover Logic
    let interval;
    function startCycle(card) {
        const imgs = card.querySelectorAll('img');
        let i = 0;
        interval = setInterval(() => {
            imgs[i].classList.remove('active');
            i = (i + 1) % imgs.length;
            imgs[i].classList.add('active');
        }, 800);
    }
    function stopCycle() { clearInterval(interval); }

    // Origami Logic
    function openOrigami(src) {
        const modal = document.getElementById('modal');
        // We use the same image for both top and bottom panels
        document.getElementById('imgTop').src = src;
        document.getElementById('imgBottom').src = src;
        
        modal.classList.add('open');
    }

    function closeModal() {
        document.getElementById('modal').classList.remove('open');
    }

    // Background Embers
    const canvas = document.getElementById('bgCanvas');
    const ctx = canvas.getContext('2d');
    let pts = [];
    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    class Pt {
        constructor() { this.reset(); }
        reset() {
            this.x = Math.random() * canvas.width;
            this.y = canvas.height + 10;
            this.s = Math.random() * 2;
            this.v = Math.random() * 2 + 1;
            this.a = 1;
        }
        draw() {
            this.y -= this.v; this.a -= 0.005;
            if (this.a <= 0) this.reset();
            ctx.fillStyle = `rgba(255, 80, 0, ${this.a})`;
            ctx.beginPath(); ctx.arc(this.x, this.y, this.s, 0, 7); ctx.fill();
        }
    }
    function anim() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        if(pts.length < 50) pts.push(new Pt());
        pts.forEach(p => p.draw());
        requestAnimationFrame(anim);
    }
    window.onresize = resize; resize(); anim(); init();
</script>
</body>
</html>
